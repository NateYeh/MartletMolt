# TASK-CORE-007: ç©©å®šæ€§å»ºè¨­ (Unit Tests) â³

## ğŸ¯ ä»»å‹™ç›®æ¨™
å»ºç«‹ MartletMolt çš„æ ¸å¿ƒæ¸¬è©¦é«”ç³»ï¼Œç¢ºä¿ç³»çµ±åœ¨é€²è¡Œã€Œè‡ªæˆ‘é€²åŒ–ã€æˆ–ç¨‹å¼ç¢¼é‡å¯«æ™‚ï¼Œå…·å‚™è‡ªå‹•åŒ–çš„é©—è­‰æ©Ÿåˆ¶ä»¥é˜²æ­¢åŠŸèƒ½å€’é€€ (Regression)ã€‚

## ğŸ“ è©³ç´°è¦æ ¼

### 1. æ¸¬è©¦æ¡†æ¶é¸æ“‡
- **å·¥å…·**: `pytest`, `pytest-asyncio`
- **Mocking**: `unittest.mock` æˆ– `pytest-mock` (ç”¨æ–¼æ¨¡æ“¬ LLM API èª¿ç”¨)
- **API æ¸¬è©¦**: `httpx` (FastAPI TestClient)

### 2. æ¸¬è©¦è¦†è“‹é‡é» (å„ªå…ˆç´š)
- **P0: æ ¸å¿ƒé‚è¼¯ (Core)**
    - `session.py`: æœƒè©±å»ºç«‹ã€å­˜å„²ã€æ­·å²è¨˜éŒ„æ¸…ç†ã€Token è¨ˆæ•¸ã€‚
    - `stream_buffer.py`: ä¸²æµæ•¸æ“šçš„æ­£ç¢ºç·©è¡èˆ‡æ‹¼æ¥ã€‚
    - `config.py`: ç’°å¢ƒè®Šæ•¸è®€å–èˆ‡é è¨­å€¼é©—è­‰ã€‚
- **P1: æä¾›è€…æ¥å£ (Providers)**
    - `ollama.py` / `openai.py`: æ¨¡æ“¬ API éŸ¿æ‡‰ï¼Œé©—è­‰æ•¸æ“šæ ¼å¼è½‰æ› (LLM Output -> Internal Message)ã€‚
- **P2: é–˜é“å™¨ API (Gateway)**
    - `routes.py`: é©—è­‰ `/chat` ç«¯é»æ˜¯å¦èƒ½æ­£ç¢ºæ¥æ”¶ä¸¦è½‰ç™¼è«‹æ±‚ã€‚
    - `websocket.py`: é©—è­‰ WebSocket é€£ç·šæ¡æ‰‹èˆ‡åŸºæœ¬é€šè¨Šã€‚
- **P3: åŸºç¤å·¥å…· (Tools)**
    - `shell.py`: é©—è­‰å‘½ä»¤åŸ·è¡Œèˆ‡éŒ¯èª¤æ•ç²ã€‚
    - `file_read.py` / `file_write.py`: é©—è­‰æª”æ¡ˆè®€å¯«æ¬Šé™èˆ‡è·¯å¾‘å®‰å…¨ã€‚

## ğŸ“ ä¿®æ”¹è·¯å¾‘æ¸…å–®
- `/tests/` (æ–°å¢å„æ¨¡çµ„æ¸¬è©¦æ–‡ä»¶)
- `backend/system_a/martlet_molt/` (å¯èƒ½éœ€èª¿æ•´ä»£ç¢¼ä»¥æé«˜å¯æ¸¬è©¦æ€§/ä¾è³´æ³¨å…¥)

## âœ… é©—è­‰æ–¹å¼
1. åŸ·è¡Œ `pytest` ç¸½è¦†è“‹ç‡æå‡è‡³ 60% ä»¥ä¸Šã€‚
2. æ‰€æœ‰æ¸¬è©¦æ¡ˆä¾‹é€šéä¸”ç„¡ Side Effectã€‚

---
**ç‹€æ…‹**: â³ é–‹ç™¼ä¸­  
**è² è²¬äºº**: Martlet Guardian (AI)  
**é–‹å§‹æ—¥æœŸ**: 2025-02-23
